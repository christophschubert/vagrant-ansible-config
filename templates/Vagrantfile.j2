# Generated by vagrant-ansible-config on {{ now() }}
Vagrant.configure("2") do |config|

  config.vm.box = "{{ machines['base_box']}}"
  config.ssh.insert_key = false
  config.ssh.private_key_path = ["~/.vagrant.d/insecure_private_key", "{{ machines['ssh_key']}}"]
  config.vm.provision "file", source: "{{ machines['ssh_key'] }}.pub", destination: "~/.ssh/authorized_keys"
  {% for group in machines['nodes'] %}
  # bring up {{group['role']}} VMs
  (1..{{group['count']}}).each do |machine_id|
    config.vm.define "{{group['role']}}-#{machine_id}" do |machine|
      machine.vm.hostname = "{{group['role'] | replace('_', '-')}}-#{machine_id}"
      machine.vm.network "private_network", ip: "{{machines['cidr_block']}}.#{{'{'}}{{ group['start_ip']}} + machine_id}"
    end
  end
{% endfor %}
end
